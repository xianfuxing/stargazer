{% extends 'server_base.html' %}
{% load common_tags %}
{% block title %}监控详情{% endblock %}

{% block content_header %}
    <section class="content-header">
        <h1>Monitor List
            <small>监控列表</small>
        </h1>
    </section>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-6">
            <div class="trigger-list">
                {% get_trigger_count request as trigger_count %}
                {% if status_count > 0 or trigger_count > 0 %}
                    <p>最近{{ trigger_count }}个问题</p>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}


{% block javascript %}
    {{  block.super }}
    <script>
         $.ajax({
             url: "{% url 'monitor:trigger' %}",
             type: 'get',
             dataType: 'json',
             async: true,
             success: function (data) {
                 if(jQuery.isEmptyObject(data)) {
                     $('.trigger-list').append('<div class="callout callout-info"><p>没有警告</p></div>');
                 } else {
                     for(var host in data) {
                         var triggers = data[host];
                         $('.trigger-list').append('<div class="callout callout-warning '+ host +'"><h4>'+host+'</h4></div>');
                         for(var i=0; i<triggers.length; i++) {
                             $('.'+host).append('<p>- '+triggers[i].description.replace(/{.*?}/, '')+'</p>');
                         }
                     }
                 }
             }

         });
    </script>
{% endblock %}